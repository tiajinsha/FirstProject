!function(e,n){for(var o in n)e[o]=n[o]}(exports,function(e){var n={};function o(t){if(n[t])return n[t].exports;var r=n[t]={i:t,l:!1,exports:{}};return e[t].call(r.exports,r,r.exports,o),r.l=!0,r.exports}return o.m=e,o.c=n,o.d=function(e,n,t){o.o(e,n)||Object.defineProperty(e,n,{enumerable:!0,get:t})},o.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,n){if(1&n&&(e=o(e)),8&n)return e;if(4&n&&"object"==typeof e&&e&&e.__esModule)return e;var t=Object.create(null);if(o.r(t),Object.defineProperty(t,"default",{enumerable:!0,value:e}),2&n&&"string"!=typeof e)for(var r in e)o.d(t,r,function(n){return e[n]}.bind(null,r));return t},o.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(n,"a",n),n},o.o=function(e,n){return Object.prototype.hasOwnProperty.call(e,n)},o.p="",o(o.s=2)}([function(e,n){e.exports=require("express")},function(e,n,o){var t=o(7).createPool({host:"127.0.0.1",user:"root",password:"",port:3306,database:"xz",connectionLimit:15});e.exports=t},function(e,n,o){const t=o(0),r=o(3),i=(o(4),o(5)),s=o(6),u=o(8),l=o(11);var a=t();a.use(r({origin:["http://192.168.0.103:8081","http://192.168.0.103:8080","http://127.0.0.1","http://127.0.0.1:8080","http://106.12.179.113","http://192.168.0.103"],credentials:!0})),a.use(i({secret:"128位字符串",resave:!0,saveUninitialized:!0})),a.use(t.static("public")),a.use(t.static("upload")),a.use(t.static("fenxiang")),a.listen(3e3,()=>{console.log(3e3)}),a.use("/login",s),a.use("/fenxiang",u),a.use("/common",l)},function(e,n){e.exports=require("cors")},function(e,n){e.exports=require("iconv-lite")},function(e,n){e.exports=require("express-session")},function(e,n,o){const t=o(0).Router(),r=o(1);t.get("/login",(e,n)=>{var o=e.query.uname,t=e.query.upwd;null==o&&null==t?console.log("null"):r.query("SELECT id,img_url FROM  xz_login WHERE uname = ? AND upwd = md5(?)",[o,t],(o,t)=>{if(o)throw o;if(0==t.length)n.send({code:-1,msg:"用户名或密码有误"});else{e.session.uid=t[0].id;var r={code:1,msg:"登录成功"};r.data=t,n.send(r)}})}),t.get("/loginUp",(e,n)=>{e.session.destroy(),console.log("注销成功"),n.send({code:1,data:"注销成功"})}),t.get("/insert",(e,n)=>{var o=e.query.uname,t=e.query.data,i=e.query.upwd;console.log(t);var s=`insert into xz_login(uname,upwd,img_url) values('${o}',md5('${i}'),'${t}')`;r.query(s,(e,t)=>{if(e)throw e;console.log(t),imgname=o,n.send({code:1,data:"成功"})})}),t.get("/loginMsg",(e,n)=>{var o=e.session.uid;if(console.log(o),!o)return console.log(o),void n.send({code:-1,msg:"请登录"});r.query("select id,img_url,uname from xz_login where id= ?",[o],(e,o)=>{if(e)throw e;n.send({code:1,data:o})})}),e.exports=t},function(e,n){e.exports=require("mysql")},function(e,n,o){const t=o(0).Router();var r=o(9),i=o(10),s=function(e){try{r.accessSync(e)}catch(n){r.mkdirSync(e)}};s("./upload/");var u=i.diskStorage({destination:function(e,n,o){o(null,"./upload/")},filename:function(e,n,o){o(null,n.originalname)}}),l=i({storage:u});t.post("/upload",l.single("file"),(e,n,o)=>{var t=e.file;console.log("文件类型：%s",t.mimetype),console.log("原始文件名：%s",t.originalname),console.log("文件大小：%s",t.size),console.log("文件保存路径：%s",t.path);var r={code:1,msg:"success"};r.data=t.originalname,n.send(r),console.log(r)}),t.get("/form",function(e,n,o){var t=r.readFileSync("./form.html",{encoding:"utf8"});n.send(t),console.log(123)});s("./fenxiang/");u=i.diskStorage({destination:function(e,n,o){o(null,"./fenxiang/")},filename:function(e,n,o){o(null,n.originalname)}}),l=i({storage:u});t.post("/upload-multi",l.array("file"),(e,n,o)=>{var t=[];e.files.length<1&&console.log("没有图片"),e.files.forEach(e=>{t.push(e.originalname)});n.send(t)}),e.exports=t},function(e,n){e.exports=require("fs")},function(e,n){e.exports=require("multer")},function(e,n,o){const t=o(0).Router(),r=o(12),i=o(1);t.get("/bing",(e,n)=>{e.query.page,e.query.count,e.query.serurl;r.get("http://cn.bing.com/HPImageArchive.aspx?format=js&idx=0&n=1",function(e){e.on("data",function(e){var n=e.toString(),o=JSON.parse(n);console.log(o)})})}),t.get("/title",(e,n)=>{var o=e.query.data,t=e.query.title;if(o&&t){var r={title:t,img_url0:o[0],img_url1:o[1],img_url2:o[2],img_url3:o[3],img_url4:o[4],img_url5:o[5],img_url6:o[6],img_url7:o[7],img_url8:o[8]};i.query("insert into xz_fenxiang set ?",[r],(e,o)=>{if(e)throw e;console.log(o),n.send({code:1,msg:"上传成功"})})}else o?t||console.log("没有文字"):console.log("没有图片"),n.send({code:0,msg:"上传失败"})}),t.get("/fenxiang",(e,n)=>{i.query("select * from xz_fenxiang",(e,o)=>{if(e)throw e;console.log(o),n.send({code:1,result:o})})}),e.exports=t},function(e,n){e.exports=require("http")}]));