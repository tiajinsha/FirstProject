!function(e,o){for(var r in o)e[r]=o[r]}(exports,function(e){var o={};function r(t){if(o[t])return o[t].exports;var n=o[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,r),n.l=!0,n.exports}return r.m=e,r.c=o,r.d=function(e,o,t){r.o(e,o)||Object.defineProperty(e,o,{enumerable:!0,get:t})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,o){if(1&o&&(e=r(e)),8&o)return e;if(4&o&&"object"==typeof e&&e&&e.__esModule)return e;var t=Object.create(null);if(r.r(t),Object.defineProperty(t,"default",{enumerable:!0,value:e}),2&o&&"string"!=typeof e)for(var n in e)r.d(t,n,function(o){return e[o]}.bind(null,n));return t},r.n=function(e){var o=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(o,"a",o),o},r.o=function(e,o){return Object.prototype.hasOwnProperty.call(e,o)},r.p="",r(r.s=0)}([function(e,o,r){const t=r(1),n=r(2),i=r(3),s=r(4);var u=r(5);r(6);var l=r(7),c=r(8),a=n.createPool({host:"127.0.0.1",user:"root",password:"",port:3306,database:"xz",connectionLimit:15}),d=t();d.use(i({origin:["http://127.0.0.1:8081","http://127.0.0.1:8080","http://192.168.0.103:8080"],credentials:!0})),d.use(s({secret:"128位字符串",resave:!0,saveUninitialized:!0})),d.use(t.static("public")),d.use(t.static("upload")),d.listen(3e3,()=>{console.log(3e3)});d.get("/",(e,o)=>{console.log(123)}),d.get("/login",(e,o)=>{var r=e.query.uname,t=e.query.upwd;null==r&&null==t?console.log("null"):a.query("SELECT id,img_url FROM  xz_login WHERE uname = ? AND upwd = md5(?)",[r,t],(r,t)=>{if(r)throw r;if(0==t.length)o.send({code:-1,msg:"用户名或密码有误"});else{e.session.uid=t[0].id;var n={code:1,msg:"登录成功"};n.data=t,o.send(n)}})}),d.get("/loginUp",(e,o)=>{e.session.destroy(),console.log("注销成功"),o.send({code:1,data:"注销成功"})}),d.get("/insert",(e,o)=>{var r=e.query.uname,t=e.query.data,n=e.query.upwd;console.log(t);var i=`insert into xz_login(uname,upwd,img_url) values('${r}',md5('${n}'),'${t}')`;a.query(i,(e,t)=>{if(e)throw e;console.log(t),r,o.send({code:1,data:"成功"})})}),d.get("/bing",(e,o)=>{e.query.page,e.query.count,e.query.serurl;u.get("http://cn.bing.com/HPImageArchive.aspx?format=js&idx=0&n=1",function(e){e.on("data",function(e){var o=e.toString(),r=JSON.parse(o);console.log(r)})})});!function(e){try{l.accessSync(e)}catch(o){l.mkdirSync(e)}}("./upload/");var g=c.diskStorage({destination:function(e,o,r){r(null,"./upload/")},filename:function(e,o,r){r(null,o.originalname)}}),f=c({storage:g});d.post("/upload",f.single("file"),(e,o,r)=>{var t=e.file;console.log("文件类型：%s",t.mimetype),console.log("原始文件名：%s",t.originalname),console.log("文件大小：%s",t.size),console.log("文件保存路径：%s",t.path);var n={code:1,msg:"success"};n.data=t.originalname,o.send(n),console.log(n)}),d.get("/form",function(e,o,r){var t=l.readFileSync("./form.html",{encoding:"utf8"});o.send(t),console.log(123)}),d.get("/loginMsg",(e,o)=>{var r=e.session.uid;if(console.log(r),!r)return console.log(r),void o.send({code:-1,msg:"请登录"});a.query("select id,img_url,uname from xz_login where id= ?",[r],(e,r)=>{if(e)throw e;o.send({code:1,data:r})})}),d.get("/delete",(e,o)=>{var r=e.query.id;a.query("delete from xz_cart where id=?",[r],(e,r)=>{if(e)throw e;r.affectedRows>0?o.send({code:1,msg:"delete suc"}):o.send({code:-1,msg:"成功"})})}),d.get("/product",(e,o)=>{var r=e.query.pno,t=e.query.pageSize;r||0!=r||(r=1),t||(t=4);var n={code:1,msg:"查询成功"},i=(r-1)*t;t=parseInt(t),a.query("SELECT lid,price,title,img_url FROM xz_laptop LIMIT ?,?",[i,t],(e,r)=>{if(e)throw e;n.data=r;a.query("SELECT count(*) AS c FROM xz_laptop",(e,r)=>{if(e)throw e;var i=Math.ceil(r[0].c/t);console.log(r),n.pc=i,o.send(n),console.log(n)})})}),d.get("/cart",(e,o)=>{var r=e.session.uid;if(!r)return console.log(r),void o.send({code:-1,msg:"请登录"});a.query("select id,img_url,title,price,count from xz_cart where uid= ?",[r],(e,r)=>{if(e)throw e;o.send({code:1,data:r})})}),d.get("/delete",(e,o)=>{var r=e.query.id;a.query("delete from xz_cart where id=?",[r],(e,r)=>{if(e)throw e;r.affectedRows>0?o.send({code:1,msg:"delete suc"}):o.send({code:-1,msg:"成功"})})}),d.get("/delAll",(e,o)=>{var r=`DELETE FROM xz_cart WHERE id IN (${e.query.ids})`;a.query(r,(e,r)=>{if(e)throw e;r.affectedRows>0?o.send({code:1,msg:"删除成功"}):o.send({code:-1,msg:"删除失败"})})})},function(e,o){e.exports=require("express")},function(e,o){e.exports=require("mysql")},function(e,o){e.exports=require("cors")},function(e,o){e.exports=require("express-session")},function(e,o){e.exports=require("http")},function(e,o){e.exports=require("iconv-lite")},function(e,o){e.exports=require("fs")},function(e,o){e.exports=require("multer")}]));